_format_version: "3.0"
_transform: true

# ===============================
# üß± SERVICIO DE COTIZACI√ìN
# ===============================
services:
  - name: cotizacion-service
    host: cotizacion.internal
    protocol: http
    port: 8080
    routes:
      - name: cotizacion-route
        paths:
          - /cotizaciones
          - /crear-cotizacion
        strip_path: true

# ===============================
# üåê SERVICIO GENERAL (DJANGO)
# ===============================
  - name: general-service
    host: general.internal
    protocol: http
    port: 8080
    routes:
      - name: general-route
        
        strip_path: true

# ===============================
# üß© UPSTREAMS (Balanceadores)
# ===============================
upstreams:
  - name: cotizacion.internal
    targets:
      - target: 172.31.28.101:8080
      - target: 172.31.23.138:8080
      - target: 172.31.28.211:8080
      - target: 172.31.29.115:8080
    healthchecks:
      active:
        type: http
        http_path: /actuator/health
        healthy:
          interval: 10
          successes: 2
        unhealthy:
          interval: 10
          http_failures: 3
      passive:
        unhealthy:
          http_failures: 5

  - name: general.internal
    targets:
      - target: 54.242.141.10:8080  # IP p√∫blica del Django (general)
    healthchecks:
      active:
        type: http
        http_path: /
        healthy:
          interval: 10
          successes: 2
        unhealthy:
          interval: 10
          http_failures: 3

# ===============================
# üóÑÔ∏è BASE DE DATOS (referencia interna)
# ===============================
  - name: database.internal
    targets:
      - target: 172.31.24.59:5432
