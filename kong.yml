_format_version: "2.1"
_transform: true

# ===============================
# ðŸ§± SERVICIO DE COTIZACIÃ“N
# ===============================
services:
  - name: cotizacion_service
    host: cotizacion.internal
    protocol: http
    port: 8080
    routes:
      - name: cotizacion_route
        paths:
          - /cotizaciones
          - /crear-cotizacion
        strip_path: true

  - name: general_service
    host: general.internal
    protocol: http
    port: 8080
    routes:
      - name: general_route
        paths:
          - /
        strip_path: true

# ===============================
# ðŸ§© UPSTREAMS (Balanceadores)
# ===============================
upstreams:
  - name: cotizacion_upstream
    targets:
      - target: 172.31.31.90:8080
        weight: 100
      - target: 172.31.20.119:8080
        weight: 100
      - target: 172.31.16.54:8080
        weight: 100
      - target: 172.31.30.224:8080
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /actuator/health
        healthy:
          interval: 10
          successes: 2
        unhealthy:
          interval: 10
          http_failures: 3
      passive:
        unhealthy:
          http_failures: 5

  - name: general_upstream
    targets:
      - target: 172.31.20.152:8080
        weight: 100
    healthchecks:
      active:
        type: http
        http_path: /
        healthy:
          interval: 10
          successes: 2
        unhealthy:
          interval: 10
          http_failures: 3

  - name: database_upstream
    targets:
      - target: 172.31.28.140:5432
        weight: 100
